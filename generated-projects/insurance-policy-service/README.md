# Insurance Policy Service

Manages insurance policies with Clean Architecture - Enterprise Microservice

**Generated by BMAD Spring Boot Clean Architecture Generator v1.0**

## Overview

This is an enterprise-grade microservice for managing insurance policies, built with Clean Architecture principles and Domain-Driven Design (DDD) patterns. The service provides RESTful APIs for policy creation, management, and lifecycle operations.

## Architecture

This project follows **Clean Architecture** (also known as Hexagonal/Ports & Adapters Architecture):

```
┌─────────────────────────────────────────────────────────┐
│                    Presentation Layer                    │
│            (REST Controllers, Exception Handlers)        │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                   Application Layer                      │
│         (Use Cases, Services, DTOs, Orchestration)       │
└────────────────────┬────────────────────────────────────┘
                     │
┌────────────────────▼────────────────────────────────────┐
│                    Domain Layer                          │
│    (Entities, Value Objects, Domain Services, Ports)     │
│              (Pure Business Logic - No Dependencies)     │
└─────────────────────────────────────────────────────────┘
                     ▲
┌────────────────────┴────────────────────────────────────┐
│                 Infrastructure Layer                     │
│    (JPA Repositories, External APIs, Database Config)    │
└─────────────────────────────────────────────────────────┘
```

### Layer Responsibilities

- **Domain Layer**: Pure business logic with no framework dependencies
  - Entities with business rules
  - Value Objects (immutable records)
  - Repository interfaces (ports)
  - Domain services

- **Application Layer**: Orchestrates use cases
  - Use case implementations
  - Input/Output DTOs
  - Service classes
  - Transaction management

- **Infrastructure Layer**: Technical implementations
  - JPA entities and repositories
  - Database adapters
  - External service clients
  - Configuration classes

- **Presentation Layer**: External interface
  - REST controllers
  - Request/Response models
  - Exception handlers
  - OpenAPI documentation

## Features

- Spring Boot 3.2 with Java 21
- PostgreSQL database
- Clean Architecture with ArchUnit enforcement
- OpenAPI/Swagger documentation
- Actuator for monitoring
- Validation with Bean Validation
- Resilience4j patterns (Circuit Breaker, Retry, Bulkhead)
- Complete test pyramid (Unit, Integration, Contract, Architecture)
- TestContainers for integration tests
- Pact for consumer-driven contract testing

## Prerequisites

- Java 21+
- Maven 3.8+
- PostgreSQL 14+ (or Docker)
- Docker (optional, for TestContainers)

## Getting Started

### 1. Database Setup

Create a PostgreSQL database:

```sql
CREATE DATABASE insurance_policy_db;
```

Update `src/main/resources/application.properties` with your database credentials:

```properties
spring.datasource.url=jdbc:postgresql://localhost:5432/insurance_policy_db
spring.datasource.username=your_username
spring.datasource.password=your_password
```

### 2. Build the Project

```bash
mvn clean install
```

### 3. Run the Application

```bash
mvn spring-boot:run
```

The application will start on `http://localhost:8080`

### 4. Access API Documentation

Open Swagger UI: `http://localhost:8080/swagger-ui.html`

API Docs JSON: `http://localhost:8080/api-docs`

### 5. Health Check

```bash
curl http://localhost:8080/actuator/health
```

## API Endpoints

### Create Policy

**POST** `/api/v1/policies`

```json
{
  "customerId": "CUST-001",
  "effectiveDate": "2025-12-01",
  "coverages": [
    {
      "coverageType": "Liability",
      "premiumAmount": 500.00,
      "currency": "USD"
    },
    {
      "coverageType": "Collision",
      "premiumAmount": 300.00,
      "currency": "USD"
    }
  ]
}
```

**Response (201 Created)**:

```json
{
  "policyNumber": "POL-2025-000001",
  "totalPremiumAmount": 800.00,
  "totalPremiumCurrency": "USD",
  "status": "DRAFT"
}
```

## Running Tests

### Unit Tests

```bash
mvn test
```

### Integration Tests

```bash
mvn verify
```

### Architecture Tests (ArchUnit)

The project includes ArchUnit tests that enforce Clean Architecture rules:

```bash
mvn test -Dtest=ArchitectureTest
```

These tests will fail the build if architectural violations are detected.

## Adding New Features

This project follows Test-Driven Development (TDD). Use the following BMAD workflows:

1. **Add Entity**: `bmad add-entity`
2. **Add Use Case**: `bmad add-use-case`
3. **Add REST Endpoint**: `bmad add-rest-endpoint`

All workflows follow the Red-Green-Refactor TDD cycle.

## Project Structure

```
src/
├── main/
│   ├── java/
│   │   └── com/insurance/policy/
│   │       ├── domain/
│   │       │   ├── entity/          # Domain entities
│   │       │   ├── valueobject/     # Value objects (Records)
│   │       │   ├── port/            # Repository interfaces
│   │       │   ├── service/         # Domain services
│   │       │   └── event/           # Domain events
│   │       ├── application/
│   │       │   ├── usecase/         # Use case interfaces
│   │       │   ├── service/         # Use case implementations
│   │       │   └── dto/             # Data transfer objects
│   │       ├── infrastructure/
│   │       │   ├── adapter/
│   │       │   │   ├── persistence/ # JPA adapters
│   │       │   │   └── external/    # External service clients
│   │       │   └── config/          # Spring configurations
│   │       └── presentation/
│   │           └── rest/            # REST controllers
│   │               ├── model/       # Request/Response models
│   │               └── exception/   # Exception handlers
│   └── resources/
│       ├── application.properties
│       └── application-test.properties
└── test/
    └── java/
        └── com/insurance/policy/
            ├── ArchitectureTest.java    # ArchUnit tests
            ├── domain/                  # Domain unit tests
            ├── application/             # Use case tests
            └── presentation/            # Controller tests
```

## Code Coverage

This project uses JaCoCo for code coverage with a minimum threshold of 85%.

```bash
mvn clean test jacoco:report
```

View coverage report: `target/site/jacoco/index.html`

## Monitoring

Actuator endpoints are available at:

- Health: `http://localhost:8080/actuator/health`
- Info: `http://localhost:8080/actuator/info`
- Metrics: `http://localhost:8080/actuator/metrics`
- Prometheus: `http://localhost:8080/actuator/prometheus`

## Technologies

- **Spring Boot 3.2** - Application framework
- **Java 21** - Language (with virtual threads)
- **PostgreSQL** - Primary database
- **Spring Data JPA** - Data access
- **Hibernate** - ORM
- **Bean Validation** - Input validation
- **Springdoc OpenAPI** - API documentation
- **ArchUnit** - Architecture testing
- **JUnit 5** - Unit testing
- **Mockito** - Mocking framework
- **TestContainers** - Integration testing
- **REST Assured** - API testing
- **Pact** - Contract testing
- **Resilience4j** - Resilience patterns
- **JaCoCo** - Code coverage
- **SLF4J/Logback** - Logging

## License

MIT License

## Generated By

BMAD Spring Boot Clean Architecture Generator v1.0

- Scenario: Enterprise Microservice
- Database: PostgreSQL
- ArchUnit Strictness: Standard
- Examples: Policy Management

## Support

For issues and questions, please refer to the BMAD documentation or contact the development team.
