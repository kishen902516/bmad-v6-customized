# Spring Boot Clean Arch - Official Installation Guide

**Date:** 2025-11-07
**Status:** Preparation for Official BMAD Installer
**Goal:** Complete official installation with full manifest registration

---

## Executive Summary

We are preparing to **reinstall** the Spring Boot Clean Architecture Generator module using the **official BMAD Custom Module Installer**. This will complete **Phase 8: Manifest Updates** that was skipped during our manual installation.

**Current Status:** 90% complete (functional but not officially registered)
**Target Status:** 100% complete (functional AND officially registered)

---

## Why Official Installation?

### What We Gain

1. **Official Registration**
   - Module added to `bmad/_cfg/manifest.yaml`
   - Agents registered in `agent-manifest.csv`
   - Workflows registered in `workflow-manifest.csv`
   - Files tracked in `files-manifest.csv`

2. **Official Agent Compilation**
   - YAML agents compiled with official YamlXmlBuilder
   - Consistent XML structure across all BMAD modules
   - Proper handler detection
   - Standard format

3. **Generated Configuration**
   - config.yaml generated by official process
   - Variable substitution handled correctly
   - Inherits core configuration values
   - Standard structure

4. **Future-Proof**
   - Compatible with BMAD tooling
   - Standard upgrade path
   - Official support
   - Best practices followed

### What We Keep

- ✅ All module functionality (unchanged)
- ✅ All templates (unchanged)
- ✅ All workflows (unchanged)
- ✅ All testing results (validated)
- ✅ All documentation (preserved)

---

## Pre-Installation Checklist

### Step 1: Backup Current Installation ✅

**Backup locations created:**
```bash
# Module files backup
bmad/spring-boot-clean-arch-manual-backup/

# Slash commands backup
.claude/commands/bmad/spring-boot-clean-arch-manual-backup/

# Configuration backup
bmad/spring-boot-clean-arch/config.yaml.backup
```

**Backup includes:**
- All agent YAML files
- All workflows
- All templates
- All data files
- Manual slash commands
- Current config.yaml

### Step 2: Document Current Configuration ✅

**Current Settings (from config.yaml):**
```yaml
user_name: Kishen Sivalingam
communication_language: English
document_output_language: English
output_folder: '{project-root}/docs'

# Module-specific (to be recreated by installer)
projects_output_path: '{project-root}/generated-projects'
default_scenario: 'enterprise'
include_examples: 'yes'
archunit_strictness: 'standard'
default_database: 'postgresql'
module_version: '1.0.0'
```

**These will be provided to installer during configuration phase.**

### Step 3: Verify Module Structure ✅

**Required files exist:**
- ✅ `agents/` directory with 4 YAML files
- ✅ `_module-installer/install-config.yaml`
- ✅ `workflows/` directory with 9 workflows
- ✅ `templates/` directory
- ✅ `data/` directory
- ✅ `README.md`

**Module is READY for official installer.**

---

## Installation Procedure

### Phase 1: Prepare Module for Installation

**Remove generated config.yaml:**
```bash
# Backup first
cp bmad/spring-boot-clean-arch/config.yaml bmad/spring-boot-clean-arch/config.yaml.backup

# Remove (will be regenerated by installer)
rm bmad/spring-boot-clean-arch/config.yaml
```

**Why:** The official installer generates config.yaml from user answers. Having an existing config.yaml might interfere.

### Phase 2: Run Official Installer

**Command:**
```bash
npx bmad-method install-module bmad/spring-boot-clean-arch
```

**What will happen:**
1. **Validation** - Checks module structure
2. **Core Check** - Verifies BMAD core exists (6.0.0-alpha.5)
3. **Configuration Questions** - Interactive prompts (see Phase 3)
4. **File Installation** - Copies module files
5. **Agent Compilation** - Compiles YAML → MD
6. **Config Generation** - Creates config.yaml
7. **IDE Integration** - Creates slash commands
8. **Manifest Updates** - Registers module in _cfg
9. **Validation** - Verifies success
10. **Completion** - Displays next steps

### Phase 3: Answer Configuration Questions

**Question 1: Projects Output Path**
```
Prompt: "Where should generated Spring Boot projects be saved?"
Default: "output/spring-projects"

Answer: generated-projects
Result: {project-root}/generated-projects
```

**Question 2: Default Scenario**
```
Prompt: "Which scenario should be the default for new projects?"
Default: "enterprise"
Options:
  a) simple-crud - Minimal layers for small projects
  b) enterprise - Full DDD with all layers (Recommended)
  c) complex - Advanced patterns (CQRS, Event Sourcing)

Answer: enterprise (or 'b')
```

**Question 3: Include Examples**
```
Prompt: "Include example domain models from insurance industry?"
Default: "yes"
Options:
  a) yes - Include Policy Management, Claims Processing, and Underwriting examples
  b) no - Clean templates only

Answer: yes (or 'a')
```

**Question 4: ArchUnit Strictness**
```
Prompt: "ArchUnit rule strictness level?"
Default: "standard"
Options:
  a) relaxed - Warnings only, doesn't fail build
  b) standard - Recommended rules, fails on violations (Recommended)
  c) strict - All rules enforced, zero tolerance

Answer: standard (or 'b')
```

---

## Post-Installation Verification

### Step 1: Verify Manifest Registration

**Check manifest.yaml:**
```bash
cat bmad/_cfg/manifest.yaml
```

**Expected output:**
```yaml
modules:
  - core
  - bmb
  - bmm
  - spring-boot-clean-arch  # ✅ Should be present
```

**Check agent-manifest.csv:**
```bash
grep "spring-boot-clean-arch" bmad/_cfg/agent-manifest.csv
```

**Expected:** 4 agents listed:
- spring-architect
- code-generator
- test-engineer
- arch-validator

**Check workflow-manifest.csv:**
```bash
grep "spring-boot-clean-arch" bmad/_cfg/workflow-manifest.csv
```

**Expected:** 9 workflows listed:
- bootstrap-project
- add-entity
- add-use-case
- add-rest-endpoint
- add-repository
- scaffold-feature
- apply-pattern
- validate-architecture
- generate-documentation

### Step 2: Verify Configuration

**Check generated config.yaml:**
```bash
cat bmad/spring-boot-clean-arch/config.yaml
```

**Expected structure:**
```yaml
# Core Configuration Values (inherited)
user_name: Kishen Sivalingam
communication_language: English
document_output_language: English
output_folder: '{project-root}/docs'

# Module-specific paths
module_data_path: '{project-root}/bmad/spring-boot-clean-arch/data'
module_templates_path: '{project-root}/bmad/spring-boot-clean-arch/templates'
module_agents_path: '{project-root}/bmad/spring-boot-clean-arch/agents'

# Project Generation Settings
projects_output_path: '{project-root}/generated-projects'
default_scenario: 'enterprise'
include_examples: 'yes'
archunit_strictness: 'standard'

# Default Database
default_database: 'postgresql'

# Module Version
module_version: '1.0.0'
```

### Step 3: Verify Slash Commands

**Check slash command files:**
```bash
ls -la .claude/commands/bmad/spring-boot-clean-arch/agents/
ls -la .claude/commands/bmad/spring-boot-clean-arch/workflows/
```

**Expected:**
- 4 agent files (*.md)
- 9 workflow files (*.md)

**Test loading an agent:**
```
/bmad:spring-boot-clean-arch:agents:spring-architect
```

**Expected behavior:**
- Agent loads successfully
- Shows greeting with user name
- Displays menu with 10 items
- All menu items functional

### Step 4: Verify Agent Compilation

**Check compiled agent format:**
```bash
head -50 .claude/commands/bmad/spring-boot-clean-arch/agents/spring-architect.md
```

**Expected format:**
```markdown
---
name: "spring-architect"
description: "Spring Architecture Agent..."
---

You must fully embody this agent's persona...

```xml
<agent id="..." name="..." title="..." icon="...">
...
</agent>
```
```

**Note:** Format should match other BMAD agents (bmad-master, analyst, architect, etc.)

---

## Functional Testing

### Test 1: Load Spring Architecture Agent

```
/bmad:spring-boot-clean-arch:agents:spring-architect
```

**Expected:**
- ✅ Agent loads
- ✅ Shows greeting: "Welcome, Kishen Sivalingam!"
- ✅ Displays menu with 10 items
- ✅ Config loaded successfully

### Test 2: Invoke Bootstrap Workflow

```
*bootstrap-project
```

**Expected:**
- ✅ Workflow initiates
- ✅ Asks for project details
- ✅ Can proceed with generation (cancel to avoid creating test project)

### Test 3: Direct Workflow Invocation

```
/bmad:spring-boot-clean-arch:workflows:validate-architecture
```

**Expected:**
- ✅ Workflow loads
- ✅ Asks for target project
- ✅ Can execute validation

### Test 4: Config Loading

**All agents should load config correctly:**
```
/bmad:spring-boot-clean-arch:agents:code-generator
/bmad:spring-boot-clean-arch:agents:test-engineer
/bmad:spring-boot-clean-arch:agents:arch-validator
```

**Expected for each:**
- ✅ Config loads
- ✅ Shows greeting with user name
- ✅ Displays capabilities

---

## Regression Testing

### Test Generated Code (Validation)

**Use the tested insurance-policy-service as validation:**

```bash
cd generated-projects/insurance-policy-service
mvn clean test
```

**Expected:**
- ✅ Compilation: SUCCESS
- ✅ Tests: 117/117 passing (100%)
- ✅ ArchUnit: All rules passing

**If project doesn't exist anymore, generate a quick test:**
```
/bmad:spring-boot-clean-arch:agents:spring-architect
*bootstrap-project

Project name: test-validation
Base package: com.test.validation
Scenario: Simple CRUD
Database: H2
```

Then run tests:
```bash
cd generated-projects/test-validation
mvn test
```

---

## Rollback Plan (If Needed)

### If Installation Fails

**Restore from backup:**
```bash
# Restore module files
rm -rf bmad/spring-boot-clean-arch
cp -r bmad/spring-boot-clean-arch-manual-backup bmad/spring-boot-clean-arch

# Restore slash commands
rm -rf .claude/commands/bmad/spring-boot-clean-arch
cp -r .claude/commands/bmad/spring-boot-clean-arch-manual-backup .claude/commands/bmad/spring-boot-clean-arch

# Restore config
cp bmad/spring-boot-clean-arch/config.yaml.backup bmad/spring-boot-clean-arch/config.yaml
```

**Verify rollback:**
```
/bmad:spring-boot-clean-arch:agents:spring-architect
```

Should work as before.

### If Installer Not Available

**Scenario:** `npx bmad-method install-module` command doesn't exist or fails

**Fallback Plan:**
1. Keep manual installation (already working)
2. Manually update manifests (Option 1 from previous analysis)
3. Document that official installer is not yet available for custom modules

---

## Success Criteria

### Installation Complete When:

- [x] **Phase 1-7 Complete** - Module installed and functional
- [ ] **Phase 8 Complete** - Manifests updated in `_cfg/`
- [ ] **Config Generated** - config.yaml created by installer
- [ ] **Agents Compiled** - YAML → MD with official builder
- [ ] **Slash Commands Work** - All commands functional
- [ ] **Tests Pass** - Generated code compiles and tests pass
- [ ] **Documentation Updated** - Installation status documented

### Quality Gates:

1. **Manifest Registration**
   - Module in manifest.yaml ✅
   - 4 agents in agent-manifest.csv ✅
   - 9 workflows in workflow-manifest.csv ✅

2. **Functional Verification**
   - All slash commands work ✅
   - Bootstrap workflow works ✅
   - Generated code compiles ✅
   - All tests pass (117/117) ✅

3. **Configuration Validation**
   - config.yaml generated ✅
   - All variables resolved ✅
   - Config loads in agents ✅

---

## Post-Installation Documentation Updates

### Files to Update After Installation

1. **MODULE-INSTALLATION-COMPLETE.md**
   - Update status to "100% Complete - Official Installation"
   - Add manifest verification details
   - Document official installation date

2. **INSTALLATION.md**
   - Add section on official installer
   - Document the installation command
   - Update installation status

3. **README.md**
   - Update installation section
   - Reference official installer
   - Update status to "Production Ready - Officially Installed"

---

## Troubleshooting

### Issue: Installer Command Not Found

**Error:** `npx bmad-method: command not found`

**Solutions:**
1. Check if bmad-method is installed globally:
   ```bash
   npm list -g bmad-method
   ```

2. Install if missing:
   ```bash
   npm install -g bmad-method
   ```

3. Check package.json for local install:
   ```bash
   cat package.json | grep bmad
   ```

### Issue: Installer Fails Validation

**Error:** Module structure validation fails

**Solutions:**
1. Verify required files exist:
   ```bash
   ls bmad/spring-boot-clean-arch/agents/
   ls bmad/spring-boot-clean-arch/_module-installer/
   ```

2. Check agent YAML files are valid:
   ```bash
   cat bmad/spring-boot-clean-arch/agents/spring-architect.agent.yaml
   ```

3. Verify install-config.yaml is valid YAML:
   ```bash
   cat bmad/spring-boot-clean-arch/_module-installer/install-config.yaml
   ```

### Issue: Config.yaml Not Generated

**Error:** Installation completes but no config.yaml

**Solutions:**
1. Check if config.yaml was removed before install
2. Check installer output for errors
3. Manually verify configuration questions were answered
4. Restore from backup if needed

### Issue: Slash Commands Don't Work

**Error:** Agent command not recognized

**Solutions:**
1. Verify slash command files exist:
   ```bash
   ls .claude/commands/bmad/spring-boot-clean-arch/
   ```

2. Check file format matches other BMAD agents
3. Restart Claude Code session
4. Clear cache and retry

### Issue: Manifests Not Updated

**Error:** Module not in manifest.yaml after install

**Solutions:**
1. Check Phase 8 was executed (check installer output)
2. Manually verify manifest.yaml was modified
3. Check installer permissions (write access to _cfg/)
4. Manually update manifests as fallback

---

## Timeline

**Estimated Time:** 30-60 minutes

### Breakdown:
- Backup: 5 minutes
- Remove config.yaml: 1 minute
- Run installer: 10-20 minutes (including questions)
- Verification: 10-20 minutes
- Functional testing: 10-20 minutes
- Documentation updates: 5-10 minutes

---

## Next Steps After Installation

### Immediate (Day 1)

1. **Verify Installation**
   - Check all manifests
   - Test all slash commands
   - Validate configuration

2. **Test Generation**
   - Generate a test project
   - Run tests
   - Verify architecture

3. **Document Results**
   - Update installation documentation
   - Record any issues encountered
   - Update module status

### Short-Term (Week 1)

1. **Create Test Projects**
   - Test all 3 scenarios (simple-crud, enterprise, complex)
   - Validate each workflow
   - Document any differences from manual install

2. **Update User Documentation**
   - Add official installation instructions
   - Update quick start guide
   - Create video tutorial (optional)

3. **Share with Team**
   - Announce official installation
   - Share installation guide
   - Gather feedback

### Long-Term (Month 1)

1. **Monitor Usage**
   - Track module usage
   - Collect user feedback
   - Identify enhancement opportunities

2. **Contribute to BMAD**
   - Consider submitting module to official BMAD repo
   - Share with BMAD community
   - Contribute improvements

3. **Maintain Module**
   - Keep up with BMAD updates
   - Update templates as needed
   - Enhance workflows based on feedback

---

## Conclusion

This guide provides a complete roadmap for official installation of the Spring Boot Clean Architecture Generator module. By following the official BMAD installer process, we will:

- ✅ Complete Phase 8 (Manifest Updates)
- ✅ Achieve 100% installation completion
- ✅ Gain official BMAD integration
- ✅ Maintain all existing functionality
- ✅ Future-proof the installation

**Current Status:** Ready for official installation
**Backup Status:** Complete and verified
**Installation Command:** `npx bmad-method install-module bmad/spring-boot-clean-arch`

---

**Guide Version:** 1.0.0
**Created:** 2025-11-07
**Status:** Ready for Execution
