# =============================================================================
# Resilience4j Configuration
# =============================================================================

# Circuit Breaker Configuration
# -----------------------------------------------------------------------------
resilience4j.circuitbreaker.configs.default.register-health-indicator=true
resilience4j.circuitbreaker.configs.default.sliding-window-size=10
resilience4j.circuitbreaker.configs.default.minimum-number-of-calls=5
resilience4j.circuitbreaker.configs.default.permitted-number-of-calls-in-half-open-state=3
resilience4j.circuitbreaker.configs.default.automatic-transition-from-open-to-half-open-enabled=true
resilience4j.circuitbreaker.configs.default.wait-duration-in-open-state=10s
resilience4j.circuitbreaker.configs.default.failure-rate-threshold=50
resilience4j.circuitbreaker.configs.default.slow-call-rate-threshold=100
resilience4j.circuitbreaker.configs.default.slow-call-duration-threshold=60s
resilience4j.circuitbreaker.configs.default.record-exceptions=java.lang.Exception
resilience4j.circuitbreaker.configs.default.ignore-exceptions=java.lang.IllegalArgumentException

# Circuit Breaker Instance: External Service Calls
resilience4j.circuitbreaker.instances.externalService.base-config=default
resilience4j.circuitbreaker.instances.externalService.wait-duration-in-open-state=20s
resilience4j.circuitbreaker.instances.externalService.failure-rate-threshold=60

# Circuit Breaker Instance: Database Operations
resilience4j.circuitbreaker.instances.database.base-config=default
resilience4j.circuitbreaker.instances.database.sliding-window-size=20
resilience4j.circuitbreaker.instances.database.failure-rate-threshold=40

# Retry Configuration
# -----------------------------------------------------------------------------
resilience4j.retry.configs.default.max-attempts=3
resilience4j.retry.configs.default.wait-duration=1s
resilience4j.retry.configs.default.enable-exponential-backoff=true
resilience4j.retry.configs.default.exponential-backoff-multiplier=2
resilience4j.retry.configs.default.retry-exceptions=java.io.IOException,java.util.concurrent.TimeoutException
resilience4j.retry.configs.default.ignore-exceptions=java.lang.IllegalArgumentException

# Retry Instance: External API Calls
resilience4j.retry.instances.externalApi.base-config=default
resilience4j.retry.instances.externalApi.max-attempts=5
resilience4j.retry.instances.externalApi.wait-duration=2s

# Retry Instance: Database Operations
resilience4j.retry.instances.databaseRetry.base-config=default
resilience4j.retry.instances.databaseRetry.max-attempts=3
resilience4j.retry.instances.databaseRetry.wait-duration=500ms

# Bulkhead Configuration (Semaphore-based)
# -----------------------------------------------------------------------------
resilience4j.bulkhead.configs.default.max-concurrent-calls=25
resilience4j.bulkhead.configs.default.max-wait-duration=0

# Bulkhead Instance: External Service
resilience4j.bulkhead.instances.externalService.max-concurrent-calls=10
resilience4j.bulkhead.instances.externalService.max-wait-duration=10ms

# Thread Pool Bulkhead Configuration
# -----------------------------------------------------------------------------
resilience4j.thread-pool-bulkhead.configs.default.max-thread-pool-size=4
resilience4j.thread-pool-bulkhead.configs.default.core-thread-pool-size=2
resilience4j.thread-pool-bulkhead.configs.default.queue-capacity=100
resilience4j.thread-pool-bulkhead.configs.default.keep-alive-duration=20ms

# Thread Pool Bulkhead Instance: Heavy Operations
resilience4j.thread-pool-bulkhead.instances.heavyOperations.max-thread-pool-size=8
resilience4j.thread-pool-bulkhead.instances.heavyOperations.core-thread-pool-size=4
resilience4j.thread-pool-bulkhead.instances.heavyOperations.queue-capacity=50

# Rate Limiter Configuration
# -----------------------------------------------------------------------------
resilience4j.ratelimiter.configs.default.register-health-indicator=true
resilience4j.ratelimiter.configs.default.limit-for-period=10
resilience4j.ratelimiter.configs.default.limit-refresh-period=1s
resilience4j.ratelimiter.configs.default.timeout-duration=0s

# Rate Limiter Instance: API Endpoints
resilience4j.ratelimiter.instances.apiRateLimit.limit-for-period=100
resilience4j.ratelimiter.instances.apiRateLimit.limit-refresh-period=1s

# Time Limiter Configuration
# -----------------------------------------------------------------------------
resilience4j.timelimiter.configs.default.timeout-duration=3s
resilience4j.timelimiter.configs.default.cancel-running-future=true

# Time Limiter Instance: External API Calls
resilience4j.timelimiter.instances.externalApiTimeout.timeout-duration=5s

# =============================================================================
# Actuator Configuration for Resilience Monitoring
# =============================================================================
management.endpoints.web.exposure.include=health,info,metrics,circuitbreakers,circuitbreakerevents,retries,retryevents,bulkheads,bulkheadevents,ratelimiters,timelimiters
management.endpoint.health.show-details=always
management.health.circuitbreakers.enabled=true
management.health.ratelimiters.enabled=true

# Metrics Export
management.metrics.distribution.percentiles-histogram.http.server.requests=true
management.metrics.distribution.percentiles-histogram.resilience4j.circuitbreaker.calls=true
management.metrics.tags.application={{project_name}}
